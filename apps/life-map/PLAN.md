# Life Map (生活地图) - 项目计划

## 1. 项目概览 (Overview)
**Life Map** 是一个基于地理位置的生活记录应用。旨在帮助用户以地图为画布，将生活中的重要时刻、旅行足迹、日常发现以可视化的形式记录下来。用户可以在地图上探索，锁定特定地点，并创建包含丰富媒体信息（图片、视频、文字）的“记忆卡片”。

## 2. 核心功能 (Core Features)

### 2.1 地图交互
- **地图浏览**: 集成开源地图服务，支持缩放、平移。
- **地点搜索**: 提供搜索栏，支持关键词搜索地点（如“故宫”、“附近的咖啡馆”），并自动定位。
- **点击拾取**: 用户可以直接点击地图上的任意位置进行标记。

### 2.2 记忆卡片 (Memory Cards)
- **自动生成**: 选中地点后，系统自动获取该地点的基础信息（地名、大致地址）并创建一个新卡片。
- **多媒体记录**:
    - **标题**: 默认为地点名称，支持修改。
    - **封面图**: 支持上传图片作为地点封面。
    - **详细记录**: 支持富文本编辑，可混合排版文字、图片和短视频。
    - **时间戳**: 自动记录创建时间，支持用户修改为“发生时间”。
- **卡片管理**: 支持对卡片的查看、编辑、删除。

### 2.3 数据持久化
- 所有数据（包括图片和视频文件）保存在用户本地浏览器中，保护隐私且离线可用。

## 3. 技术栈 (Tech Stack)

考虑到项目需要轻量化且与其他 apps 保持一致，我们将采用以下技术栈：

- **核心语言**: Vanilla JavaScript (ES6+)
- **结构与样式**: HTML5, CSS3 (CSS Variables for theming, Flexbox/Grid layout)
- **地图引擎**: **Leaflet.js**
    - *理由*: 轻量、开源、免费、社区活跃，无需复杂的 API Key 配置即可使用 OpenStreetMap 瓦片。
- **地图数据源**: OpenStreetMap (OSM)
- **地理编码/搜索服务**: **Nominatim API** (OSM)
    - *用于*: 地点搜索和反向地理编码（坐标转地址）。
- **本地存储**: **IndexedDB**
    - *理由*: `localStorage` 容量有限（通常 5MB），无法存储大量图片和视频。IndexedDB 是浏览器内置的非关系型数据库，适合存储结构化数据和二进制文件（Blob）。
    - *工具库*: 为了简化原生 IndexedDB 的操作，可能会使用轻量级封装（如 `idb-keyval` 或手写简单的 Promise 封装）。

## 4. 数据结构设计 (Data Schema)

### LocationRecord (存储在 IndexedDB)
```json
{
  "id": "uuid-v4-string",
  "lat": 39.9042,
  "lng": 116.4074,
  "address": "北京市东城区...",
  "title": "故宫博物院",
  "content": "<p>今天天气真好...</p>", // HTML string or specific format
  "media": [
    {
      "type": "image",
      "blob": "Blob Object", // 存储实际文件数据
      "name": "photo1.jpg"
    }
  ],
  "coverImage": "Blob Object", // 封面图
  "createdAt": 1706688000000,
  "eventDate": 1706688000000
}
```

## 5. 开发计划 (Implementation Phases)

1.  **基础搭建**:
    - 创建项目结构 (`index.html`, `styles/`, `scripts/`)。
    - 引入 Leaflet.js 库。
    - 初始化地图并显示。
2.  **地图交互与搜索**:
    - 实现点击地图获取坐标。
    - 集成 Nominatim 实现搜索功能。
    - 实现反向地理编码（点击坐标自动获取地名）。
3.  **UI 开发**:
    - 设计并实现“卡片编辑器”侧边栏/弹窗。
    - 样式美化（响应式设计）。
4.  **数据层实现**:
    - 封装 IndexedDB 服务类。
    - 实现 CRUD（增删改查）接口。
5.  **业务逻辑整合**:
    - 将地图操作与数据存储打通。
    - 实现图片/视频的上传与预览。
    - 完善卡片展示逻辑。
6.  **优化与测试**:
    - 性能优化（大量标记点的渲染）。
    - 用户体验微调。
