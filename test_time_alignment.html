<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时间刻度对齐测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .time-grid {
            position: relative;
            border: 1px solid #ddd;
            background: #fafafa;
            margin: 10px 0;
        }
        .time-slot {
            height: 48px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            padding-left: 10px;
            font-size: 12px;
            color: #666;
        }
        .event-test {
            position: absolute;
            background: #3b82f6;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            left: 100px;
            width: 200px;
            border: 2px solid #1d4ed8;
        }
        .mobile-test {
            max-width: 400px;
        }
        .mobile-test .time-slot {
            height: 40px;
        }
        .info {
            background: #e0f2fe;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }
        .calculation {
            background: #f3e8ff;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>时间刻度对齐测试</h1>
    
    <div class="test-container">
        <h2>桌面端测试 (48px/小时)</h2>
        <div class="info">
            PIXEL_PER_MIN = 0.8 (48px ÷ 60分钟)<br>
            BASE_START_MIN = 420 (7:00 AM)
        </div>
        <div class="calculation">
            测试事件: 8:00-9:00 (480-540分钟)<br>
            top = (480 - 420) * 0.8 = 60 * 0.8 = 48px<br>
            height = (540 - 480) * 0.8 = 60 * 0.8 = 48px
        </div>
        <div class="time-grid" id="desktopGrid">
            <!-- 时间槽将通过JavaScript生成 -->
        </div>
    </div>
    
    <div class="test-container mobile-test">
        <h2>移动端测试 (40px/小时)</h2>
        <div class="info">
            PIXEL_PER_MIN = 0.667 (40px ÷ 60分钟)<br>
            BASE_START_MIN = 420 (7:00 AM)
        </div>
        <div class="calculation">
            测试事件: 8:00-9:00 (480-540分钟)<br>
            top = (480 - 420) * 0.667 = 60 * 0.667 = 40px<br>
            height = (540 - 480) * 0.667 = 60 * 0.667 = 40px
        </div>
        <div class="time-grid" id="mobileGrid">
            <!-- 时间槽将通过JavaScript生成 -->
        </div>
    </div>
    
    <script>
        const BASE_START_MIN = 7 * 60; // 7:00
        const END_MIN = 12 * 60; // 12:00 (只显示5小时用于测试)
        
        function pad(n) { return n < 10 ? '0' + n : '' + n; }
        function fmtHM(minutesOfDay) { 
            const h = Math.floor(minutesOfDay / 60); 
            const m = minutesOfDay % 60; 
            return `${pad(h)}:${pad(m)}`; 
        }
        
        function createTimeGrid(containerId, pixelPerMin, slotHeight) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            // 创建时间槽
            for (let min = BASE_START_MIN; min < END_MIN; min += 60) {
                const slot = document.createElement('div');
                slot.className = 'time-slot';
                slot.textContent = fmtHM(min);
                slot.style.height = slotHeight + 'px';
                container.appendChild(slot);
            }
            
            // 设置容器高度
            const totalHours = (END_MIN - BASE_START_MIN) / 60;
            container.style.height = (totalHours * slotHeight) + 'px';
            
            // 添加测试事件 8:00-9:00
            const testEvent = document.createElement('div');
            testEvent.className = 'event-test';
            testEvent.textContent = '测试事件 8:00-9:00';
            
            const startMin = 8 * 60; // 8:00
            const endMin = 9 * 60;   // 9:00
            const top = (startMin - BASE_START_MIN) * pixelPerMin;
            const height = (endMin - startMin) * pixelPerMin;
            
            testEvent.style.top = top + 'px';
            testEvent.style.height = height + 'px';
            
            // 添加计算信息到事件中
            testEvent.innerHTML = `
                测试事件 8:00-9:00<br>
                <small>top: ${top}px, height: ${height}px</small>
            `;
            
            container.style.position = 'relative';
            container.appendChild(testEvent);
            
            // 添加另一个测试事件 9:30-10:30
            const testEvent2 = document.createElement('div');
            testEvent2.className = 'event-test';
            testEvent2.style.background = '#ef4444';
            testEvent2.style.borderColor = '#dc2626';
            
            const startMin2 = 9.5 * 60; // 9:30
            const endMin2 = 10.5 * 60;  // 10:30
            const top2 = (startMin2 - BASE_START_MIN) * pixelPerMin;
            const height2 = (endMin2 - startMin2) * pixelPerMin;
            
            testEvent2.style.top = top2 + 'px';
            testEvent2.style.height = height2 + 'px';
            testEvent2.innerHTML = `
                测试事件 9:30-10:30<br>
                <small>top: ${top2}px, height: ${height2}px</small>
            `;
            
            container.appendChild(testEvent2);
        }
        
        // 创建桌面端测试
        createTimeGrid('desktopGrid', 0.8, 48);
        
        // 创建移动端测试
        createTimeGrid('mobileGrid', 40/60, 40);
        
        // 添加实时检测
        function checkAlignment() {
            const results = document.createElement('div');
            results.className = 'test-container';
            results.innerHTML = `
                <h2>对齐检测结果</h2>
                <div class="info">
                    <strong>桌面端 (48px/小时):</strong><br>
                    - 8:00事件应该在第2个时间槽的顶部 (48px)<br>
                    - 9:30事件应该在第2.5个时间槽 (150px)<br><br>
                    <strong>移动端 (40px/小时):</strong><br>
                    - 8:00事件应该在第2个时间槽的顶部 (40px)<br>
                    - 9:30事件应该在第2.5个时间槽 (125px)<br>
                </div>
                <div class="calculation">
                    当前计算结果:<br>
                    桌面端: 8:00 = ${(8*60 - BASE_START_MIN) * 0.8}px, 9:30 = ${(9.5*60 - BASE_START_MIN) * 0.8}px<br>
                    移动端: 8:00 = ${(8*60 - BASE_START_MIN) * (40/60)}px, 9:30 = ${(9.5*60 - BASE_START_MIN) * (40/60)}px
                </div>
            `;
            document.body.appendChild(results);
        }
        
        checkAlignment();
    </script>
</body>
</html>